# Oche — Ralph Progress Log
# Feature: oche-darts-league
# Started: 2026-01-28

## Codebase Patterns
- Use `npm run check` to run typecheck + tests before merging
- Tailwind CSS v4 uses `@import "tailwindcss"` in CSS (no directives like v3)
- Convex directory has its own tsconfig.json separate from the app
- Vitest uses jsdom environment with @testing-library/react for component tests
- Test setup file at `src/test-setup.ts` imports jest-dom matchers
- Mock Convex hooks with `vi.mock("convex/react", ...)` at module level
- Use `cleanup()` from @testing-library/react in `afterEach` to avoid duplicate DOM elements between tests
- Schema exports a default object with `.tables` property — use `Object.keys(schema.tables)` for introspection
- Blind players represented as `v.union(v.id("players"), v.literal("blind"))` in match pairings and games
- `BrowserRouter` goes in `main.tsx`, not `App.tsx` — tests use `MemoryRouter` wrapping `<App />`
- `useConvexAuth()` requires `ConvexProviderWithAuth`, not basic `ConvexProvider` — use `useAuth` hook as abstraction
- Internal nav links must use `<Link>` from react-router-dom, not `<a>` tags
- `ConvexAuthProvider` replaces `ConvexProvider` in main.tsx — wraps the entire app
- `useConvexAuth()` provides `isAuthenticated` and `isLoading` from the auth provider
- `useAuthActions()` from `@convex-dev/auth/react` provides `signIn` and `signOut`
- Auth forms use `signIn("password", formData)` with a hidden `flow` field ("signIn" or "signUp")
- `authTables` spread into schema adds 6 tables: authAccounts, authSessions, authRefreshTokens, authVerificationCodes, authVerifiers, authRateLimits
- Clear Vite dep cache (`rm -rf node_modules/.vite`) when adding packages that share peer deps like React

## 2026-01-28 - US-001
- Scaffolded Vite + React + TypeScript project
- Configured Tailwind CSS v4 with @tailwindcss/vite plugin
- Initialized Convex directory with tsconfig
- Set up Vitest with jsdom, @testing-library/react, jest-dom
- Added npm scripts: typecheck, test, test:watch, check
- **Tests added:** 2 new tests in src/App.test.tsx
- **Files changed:** 16 new files (project scaffolding)
- **Learnings for future iterations:**
  - Vite scaffolding with `npm create vite@latest` won't overwrite existing files — use a temp dir
  - Package name defaults to template name — remember to update it
  - Tailwind v4 uses `@import "tailwindcss"` instead of v3's `@tailwind` directives
  - Need `afterEach(cleanup)` in tests or DOM elements accumulate across tests
---

## 2026-01-28 - US-002
- Defined core database schema with 12 tables in `convex/schema.ts`
- Tables: users, leagues, leagueMemberships, invites, seasons, divisions, teams, players, matches, games, innings, playerStats
- Foreign keys use `v.id("tableName")`, enums use `v.union(v.literal(...))`
- **Tests added:** 2 new tests in `convex/schema.test.ts`
- **Files changed:** convex/schema.ts (new), convex/schema.test.ts (new)
- **Learnings for future iterations:**
  - Convex schema `defineSchema` returns an object with a `.tables` property that maps table names to their definitions
  - Schema tests can validate structure by checking `Object.keys(schema.tables)`
  - Match pairings use `v.union(v.id("players"), v.literal("blind"))` for blind support
---

## 2026-01-28 - US-003
- Added marketing landing page with hero, features, social proof, pricing, and footer
- Updated App.tsx to render LandingPage instead of placeholder
- Updated App tests to match new content
- **Tests added:** 6 new tests in `src/LandingPage.test.tsx`
- **Files changed:** src/LandingPage.tsx (new), src/LandingPage.test.tsx (new), src/App.tsx, src/App.test.tsx
- **Learnings for future iterations:**
  - Use `getAllByRole` + map to check multiple headings when `getByText` matches too broadly
  - Use `getByRole("heading", { name: /pattern/i })` for specific heading assertions
  - Landing page is a pure component with no backend dependencies — no mocking needed
---

## 2026-01-28 - US-004
- Added client-side routing with react-router-dom
- Header nav Log In/Sign Up use `<Link>` for SPA navigation
- Stub pages: LoginPage, SignupPage, Dashboard
- Auth redirect: authenticated users go from `/` to `/dashboard`
- Created `useAuth` hook as abstraction over Convex auth (stub for now)
- Updated all existing tests to wrap components in `MemoryRouter`
- **Tests added:** 6 new tests in `src/Navigation.test.tsx`
- **Files changed:** src/App.tsx, src/main.tsx, src/LandingPage.tsx, src/LoginPage.tsx (new), src/SignupPage.tsx (new), src/Dashboard.tsx (new), src/useAuth.tsx (new), src/Navigation.test.tsx (new), src/App.test.tsx, src/LandingPage.test.tsx
- **Learnings for future iterations:**
  - `BrowserRouter` belongs in main.tsx, not App.tsx — keeps App testable with MemoryRouter
  - `useConvexAuth()` throws if no auth provider configured — need `ConvexProviderWithAuth`
  - When multiple elements match (e.g., "OCHE" in header and footer), use `element.closest()` or `getByRole` with container
  - Convert all internal `<a href>` to `<Link to>` when adding routing
---

## 2026-01-28 - US-005
- Added email/password authentication with @convex-dev/auth
- Backend: convex/auth.ts (Password provider), convex/http.ts (HTTP routes), authTables in schema
- Frontend: LoginPage with email/password form, SignupPage with name/email/password form
- Dashboard now has Log Out button using signOut from useAuthActions
- useAuth hook wraps useConvexAuth for isAuthenticated/isLoading
- App.tsx simplified (ConvexProvider moved to main.tsx as ConvexAuthProvider)
- Password validation: minimum 8 characters enforced client-side
- Error display on login failure and signup failure
- **Tests added:** 12 new tests in src/LoginPage.test.tsx (5), src/SignupPage.test.tsx (5), src/AuthFlow.test.tsx (2)
- **Files changed:** convex/auth.ts (new), convex/http.ts (new), convex/schema.ts, convex/schema.test.ts, package.json, src/App.tsx, src/App.test.tsx, src/Dashboard.tsx, src/LoginPage.tsx, src/LoginPage.test.tsx (new), src/SignupPage.tsx, src/SignupPage.test.tsx (new), src/AuthFlow.test.tsx (new), src/Navigation.test.tsx, src/main.tsx, src/useAuth.tsx
- **Learnings for future iterations:**
  - `ConvexAuthProvider` replaces `ConvexProvider` — wraps app in main.tsx
  - `signIn("password", formData)` with hidden `flow` field distinguishes signup vs login
  - `authTables` adds 6 tables to schema — update schema tests' allowed tables list
  - Vite dep cache (`node_modules/.vite`) can cause "duplicate React" errors when adding new packages — clear it
  - `@testing-library/user-event` needed for form interaction tests (type, click)
---
